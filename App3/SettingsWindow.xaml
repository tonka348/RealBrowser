<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="App3.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:App3"
    xmlns:converters="using:App3.Converters">

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <ScrollViewer.Resources>
            <converters:DoubleToPercentageConverter x:Key="DoubleToPercentageConverter"/>
        </ScrollViewer.Resources>
        <StackPanel Padding="32" Spacing="20" MaxWidth="500">
            <TextBlock Text="Settings" FontSize="32" FontWeight="Bold" Margin="0,0,0,16"/>
            
            <!-- General Settings -->
            <Expander Header="General" IsExpanded="True">
                <StackPanel Spacing="16" Margin="0,8,0,0">
                    <ComboBox x:Name="HomePageCombo" Header="Homepage" Width="300" HorizontalAlignment="Left"
                              SelectionChanged="HomePageCombo_SelectionChanged">
                        <ComboBoxItem Content="Default"/>
                        <ComboBoxItem Content="Blank"/>
                        <ComboBoxItem Content="Custom"/>
                    </ComboBox>

                    <TextBox x:Name="CustomHomePageBox" Header="Custom Homepage URL" 
                             PlaceholderText="https://example.com" Width="300" HorizontalAlignment="Left"
                             Visibility="Collapsed" TextChanged="CustomHomePageBox_TextChanged"/>

                    <ComboBox x:Name="StartupCombo" Header="On Startup" Width="300" HorizontalAlignment="Left"
                              SelectionChanged="StartupCombo_SelectionChanged">
                        <ComboBoxItem Tag="NewTab">Open New Tab</ComboBoxItem>
                        <ComboBoxItem Tag="Homepage">Open Homepage</ComboBoxItem>
                        <ComboBoxItem Tag="RestoreTabs">Restore Previous Tabs</ComboBoxItem>
                    </ComboBox>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBox x:Name="DownloadsPathBox" Header="Downloads Folder" 
                                 Width="240" IsReadOnly="True" TextChanged="DownloadsPathBox_TextChanged"/>
                        <Button Content="Browse..." Click="BrowseDownloadsPath_Click" 
                                VerticalAlignment="Bottom" Height="32"/>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- Appearance Settings -->
            <Expander Header="Appearance">
                <StackPanel Spacing="16" Margin="0,8,0,0">
                    <ToggleSwitch x:Name="DarkModeSwitch" Header="Dark Mode" 
                                  Toggled="DarkModeSwitch_Toggled"/>
                    
                    <ToggleSwitch x:Name="EnableAnimationsSwitch" Header="Enable Animations" 
                                  Toggled="EnableAnimationsSwitch_Toggled"/>
                    
                    <Slider x:Name="ZoomSlider" Header="Default Zoom Level" 
                            Minimum="0.5" Maximum="2.0" Value="1.0" 
                            TickFrequency="0.1" Width="300" HorizontalAlignment="Left"
                            ValueChanged="ZoomSlider_ValueChanged"/>
                    
                    <!-- Changed from x:Bind to Binding to avoid Window/FrameworkElement issue -->
                    <TextBlock Text="{Binding ElementName=ZoomSlider, Path=Value, Converter={StaticResource DoubleToPercentageConverter}}"
                               Foreground="{ThemeResource SystemBaseMediumColor}" FontSize="12"/>
                </StackPanel>
            </Expander>

            <!-- Navigation Settings -->
            <Expander Header="Navigation">
                <StackPanel Spacing="16" Margin="0,8,0,0">
                    <ToggleSwitch x:Name="EnableSwipeGesturesSwitch" Header="Enable Swipe Gestures" 
                                  Toggled="EnableSwipeGesturesSwitch_Toggled"/>
                    
                    <ToggleSwitch x:Name="AutoSaveTabsSwitch" Header="Auto-save Tabs" 
                                  Toggled="AutoSaveTabsSwitch_Toggled"/>
                </StackPanel>
            </Expander>

            <!-- Privacy & Data -->
            <Expander Header="Privacy &amp; Data">
                <StackPanel Spacing="16" Margin="0,8,0,0">
                    <Button Content="Clear Most Visited Sites" Click="ClearMostVisited_Click" 
                            HorizontalAlignment="Left"/>
                    
                    <TextBlock Text="This will permanently delete your browsing history and most visited sites." 
                               Foreground="{ThemeResource SystemBaseMediumColor}" FontSize="12" 
                               TextWrapping="Wrap" MaxWidth="300"/>
                </StackPanel>
            </Expander>

            <!-- Import/Export Settings -->
            <Expander Header="Backup &amp; Restore">
                <StackPanel Spacing="16" Margin="0,8,0,0">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button Content="Export Settings" Click="ExportSettings_Click"/>
                        <Button Content="Import Settings" Click="ImportSettings_Click"/>
                    </StackPanel>
                    
                    <TextBlock Text="Export your settings to a file or import settings from a backup." 
                               Foreground="{ThemeResource SystemBaseMediumColor}" FontSize="12" 
                               TextWrapping="Wrap" MaxWidth="300"/>
                </StackPanel>
            </Expander>

            <!-- Reset Settings -->
            <Expander Header="Reset">
                <StackPanel Spacing="16" Margin="0,8,0,0">
                    <Button Content="Reset All Settings" Click="ResetAllSettings_Click" 
                            Background="{ThemeResource SystemFillColorCriticalBrush}"
                            HorizontalAlignment="Left"/>
                    
                    <TextBlock Text="This will reset all settings to their default values. This action cannot be undone." 
                               Foreground="{ThemeResource SystemBaseMediumColor}" FontSize="12" 
                               TextWrapping="Wrap" MaxWidth="300"/>
                </StackPanel>
            </Expander>

            <!-- Version Info -->
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    CornerRadius="8" Padding="16" Margin="0,20,0,0">
                <StackPanel Spacing="8">
                    <TextBlock Text="About" FontWeight="SemiBold" FontSize="16"/>
                    <TextBlock Text="App3 Browser" FontWeight="SemiBold"/>
                    <TextBlock Text="Version 1.0.0" Foreground="{ThemeResource SystemBaseMediumColor}"/>
                    <TextBlock Text="Built with WinUI 3 and WebView2" 
                               Foreground="{ThemeResource SystemBaseMediumColor}" FontSize="12"/>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Window>